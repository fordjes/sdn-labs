---
date: "2016-11-23"
draft: false
weight: 200
title: "Lab xx - Introduction to Using Wireshark"
---
[Click here to find out more about Alta3 Research's SDN Training](https://alta3.com/courses/sdn)

### TUESDAY - &#x2B50;REQUIRED&#x2B50;

### Lab Objective
The objective of this lab is to introduce how to use Wireshark for packet capture and decoding. Wireshark is essentially TCPdump, only with a GUI. Just like TCPdump, it too can writeout, open, and manipulate packet capture files (.pcap). In this lab, you will learn how to use Wireshark to listen on interfaces, set display filters, create a Wireshark profile so you can save your layout customization (color, windows placement, etc.), colorize packets by protocol, and set-up a friendly environment for capturing the OpenFlow protocol. Wireshark is an industry standard tool; the lessons learned within this lab are directly applicable within many production environments.

### Procedure

0. Take a moment to clean up your remote Desktop. For now, close all other terminal spaces or windows you might have open.

0. Open a new terminal, then *cd* to the home student directory

  `student@beachhead:/$` `cd`

0. The Wireshark Wiki has many sample captures available for download. Before we learn to make a capture, download some OpenFlow captures.

  `student@beachhead:~$` `wget -O openflow_v1_3.pcapng.gz "https://wiki.wireshark.org/SampleCapturesaction=AttachFile&do=get&target=openflow_v1.3_messages.pcapng.gz"`

0. Decompress the file we just downloaded with the Linux program, *gunzip*.

  `student@beachhead:~$` `gunzip openflow_v1_3.pcapng.gz`

0. Launch Wireshark, and open the openflow capture file, *openflow_v1_3.pcapng*.

  `student@beachhead:~$` `wireshark openflow_v1_3.pcapng`
  
  >
  Note: Wireshark v1.x saves \*.pcap files by default, whereas Wireshark v2.x creates \*.pcapng (next-generation packet capture files).

0. Good job! You've opened a packet capture containing the OpenFlow protocol. However, right now, our focus is how to use Wireshark.

0. Now that we're no longer capturing packets, spend some time examining each of the three windows displayed. To clarify the seperate windows, a screenshot has been included.

  - **Window 1 –** Top of the screen, displays the packet list (all of the captured packets are displayed here)
    - No. (Packet Number) – A relative number assigned to each packet captured
    - Time – A timestamp assigned to each packet captured.
      - Note: You can change the information Time displays by clicking: View > Time Display Format >
    - Source – A source IP address
    - Destination – A destination IP address
    - Protocol – The protocol associated with the captured packet (i.e. SIP, RTP, DNS, DHCP, etc.)
    - Length – Packet size (number of octets)
    - Info – Some information displayed by Wireshark about each packet.

  - **Window 2 –** Packet details (review packet details here)
  
  - **Window 3 –** Packet bytes (hex)
  
  >
  See the screenshot below if you are lost.
  
  ![Alta3 Research Wireshark Windows](https://alta3.com/labs/images/alta3_sdn_wireshark01.png)

0. We might not have much use for **Window 3** (hex), so let's ask Wireshark not to display that information. Click on ** Edit > Preferences... **

  > See the screenshot below if you are lost.
  
  ![Alta3 Research Wireshark Preferences](https://alta3.com/labs/images/alta3_sdn_wireshark02.png)

0. Now click on **Appearances > Layouts**, and make sure **None** is selected for *Pane 3*.

  >
  See the screenshot below if you are lost.
  
  ![Alta3 Research Wireshark Windows](https://alta3.com/labs/images/alta3_sdn_wireshark03.png)



0. Suppose this is production traffic we wanted to save for analysis. Let's try saving the file. Navigate to **File > 


0. In the Packet List window, identify the Packet Number “No.” column.

0. Find the packet labeled “No. 16”, and *right-click* it.

0. It really doesn't matter what the packet is you just *right-clicked*, but suppose it was something important.

0. At the top of the Wireshark window, click: Telephony > RTP > Stream Analysis

0.	A new window will pop open, “Wireshark: RTP Stream analysis”, click: “Save Payload…”

0.	Another new window will pop open, “Wireshark: Save Payload As…”, make the following selections
•	Name: test.wav
•	Save in folder: student (Little picture of a black house beside it)
•	Format: (checked) .au
•	Channels: (checked) .both
8.	Click the OK button to make Wireshark export the RTP from the captured file as a playable audio file.
9.	Minimize Wireshark and any other associated windows
10.	On the Desktop, double click on the Home icon (folder with a home on it)
11.	Find the “test.wav” file you just created in this folder, double-click on it to hear it


PART B – Play captured RTP within Wireshark
1.	Close the media player, and the home window. Maximize Wireshark. If you accidentally closed Wireshark, reopen “00-2014-OpenIMS-SIP_RTP-Alice-to-Bob.pcap” and reselect packet “No. 36”
2.	At the top of the Wireshark window, within the menu, click: Telephony > VoIP Calls
3.	A new window will open, click on the topmost call (start time 0.000000),  call that appears in this window (to highlight it)
4.	Now click the player button
5.	Another window will open, “00-2014-OpenIMS-SIP_RTP-Alice-to-Bob.pcap – VoIP – RTP Player”
6.	Press the Decode button
7.	Check the box beside From 192.168.30.152:16412 to 192.168.30.164:14652
8.	Check the box beside From 192.168.30.164:14652 to 192.168.30.152:16412
9.	Press the Play button (you should hear the same conversation that you previously exported as test.wav)

Part C – Setting Display Filters
1.	Close any windows opened within Wireshark (but don’t close Wireshark)
2.	Locate the “Filter:” textbox within Wireshark. It is located in the upper left corner, just below the Menu options, and above the Time column
3.	In the Filter textbox type: mgcp
4.	Press the Apply button that is located to the right of the Filter textbox
5.	Notice that nothing is being displayed. That’s because there are no packets in this trace that match the protocol MGCP
•	If you entered MGCP (with capitals), notice how nothing changes. If that’s the case, retype ‘mgcp’ in lowercase
6.	Click the Clear button. Notice that the Filter textbox has been cleared, and all packets reappear (regardless of protocol)
7.	In the Filter textbox type: rtp
8.	Click the button Apply button
•	Notice that all packets disappear except those which are RTP packets
9.	Click the Clear button
10.	In the Filter textbox type: mgcp and rtp
11.	Click the Apply button
12.	Notice that all packets disappear, as a packet cannot be both MGCP and RTP
13.	Click the Clear button
14.	In the Filter textbox type: sip
15.	Click on the Apply button
16.	Notice that all packets disappear except those which are SIP packets

Part D – Create a Configuration Profile
1.	Before customizing Wireshark, create a ‘Configuration Profile’, so that your customized settings can be saved.
2.	Click: Edit > Configuration Profiles
3.	Click the New button, and type a unique profile name, such as, “IMS”
4.	Click the Apply button
5.	Click the OK button
6.	All customization settings will now be saved under this profile name

Part E – Colorize the Display
1.	At the top of Wireshark, within the Menu, click: View > Coloring Rules…
2.	A new window will open, “Wireshark: Coloring Rules – Profile: (your profile name)”
3.	Click the New button, this will open up a new window, “Wireshark: Edit Color Filter – Profile: (your profile name)”
4.	In the “Name” box, type: RTP
5.	In the “String” box, type: rtp
6.	Click the Background Color… button, this will open a new window, “Wireshark: Choose background color for “RTP””
7.	Choose a color and click the Select button
8.	Click the OK button
9.	Click the New button (again), this will reopen the window, “Wireshark: Edit Color Filter – Profile: (your profile name)”
10.	In the “Name” box, type: MGCP
11.	In the “String” box, type: mgcp
12.	Click the Background Color… button, this will open a new window, “Wireshark: Choose background color for ‘MGCP’”
13.	Choose a color and click the Select button
14.	Click the OK button
15.	Click the Apply button
16.	Click the OK button
17.	Feel free to modify the color scheme, or create additional coloring rules

Part F – Creating VoIP Flow Charts
1.	Click on packet “No. 1”
2.	At the top of the screen in the Wireshark menu, click: Telephony > VoIP Calls
3.	A new window will open, click on the top most call
4.	Click the Flow button
5.	Spend some time examining the newly displayed graph. Notice that if you click on the graph, Wireshark will ‘hop’ to that part of the call flow.
6.	When you’re finished, you may close both windows
7.	Click on packet “No. 1” if it is not still highlighted
8.	At the top of the Wireshark window, within the menu, click: Statistics > Flow Graph
9.	A new window will appear, “Wireshark: Flow Graph”, make the following selectionsNow click the OK button
•	(checked) Displayed Packets
•	(checked) General Flow
•	(checked) Standard source / destination addresses
10.	When you are finished examining this graph, you may close any opened windows and return to the main Wireshark screen

Part G – Performing a live Wireshark capture
1.	Close Wireshark by clicking the “X” in the right corner, or selecting: File > Quit
2.	On the Desktop, at the bottom of the screen, locate the quick launch Wireshark icon (it looks like a little blue shark fin). Click this icon.
3.	In the center left of the screen is a large green sharkfin icon, and a list of interfaces below it
4.	Click on the interface ‘any’
5.	Now click on the green sharkfin icon to start a trace
6.	Click the red Stop button to stop the trace
0. At this time, we're not looking to capture any specific traffic. So let's learn how to stop our running trace. Click the red *stop* button to stop our running capture.

Part H – Preparation for DIAMETER capture
1.	Click: Edit > Preferences
2.	Expand the Protocols tree and find DIAMETER
3.	Change the TCP ports to read 3868-3870 (no change to SCTP)
4.	Click Apply
5.	Click OK

#### Additional Learning / References

The following is a list of pages we thought might be helpful for our students to know about:

  * [Wireshark Wiki](https://wiki.wireshark.org/)
  
  * [Wireshark Wiki - Sample Captures](https://wiki.wireshark.org/SampleCaptures)

