---
date: "2016-11-23"
draft: false
weight: 210
title: "Lab XX - Mininet Part 2"
---
[Click here to find out more about Alta3 Research's SDN Training](https://alta3.com/courses/sdn)

### TUESDAY - &#x2B50;REQUIRED&#x2B50;

### Lab Objective
The objective of this lab is to...

### Procedure

0. Close any terminals you have open. Open a new terminal, and then change to the home directory.

  `student@beachhead:/$` `cd`

0. Create a basic mininet topology.

  `student@beachhead:~$` `sudo mn --topo=single,3 --controller=none --mac`
  
  ```
  *** Creating network
  *** Adding controller
  *** Adding hosts:
  h1 h2 h3
  *** Adding switches:
  s1
  *** Adding links:
  (h1, s1) (h2, s1) (h3, s1)
  *** Configuring hosts
  h1 h2 h3
  *** Starting controller

  *** Starting 1 switches
  s1 ...
  *** Starting CLI:
  ```
  
0. Take a moment to review our basic topology:

  ```
  ---------(s1)--------
  |         |         |
  h1        h2        h3
  ```

0. Dump the current configuration to the screen.

  `mininet>` `dump`
  
  ```
  <Host h1: h1-eth0:10.0.0.1 pid=17418>
  <Host h2: h2-eth0:10.0.0.2 pid=17421>
  <Host h3: h3-eth0:10.0.0.3 pid=17424>
  <OVSSwitch s1: lo:127.0.0.1,s1-eth1:None,s1-eth2:None,s1-eth3:None pid=17430>
  ```

0. 

  `mininet>` `net`
  
  ```
  h1 h1-eth0:s1-eth1
  h2 h2-eth0:s1-eth2
  h3 h3-eth0:s1-eth3
  s1 lo:  s1-eth1:h1-eth0 s1-eth2:h2-eth0 s1-eth3:h3-eth0
  ```

0. Now execute a *pingall* command. This command will **not** work, but run it anyways.

  `mininet>` `pingall`
  
  ```
  *** Ping: testing ping reachability
  h1 -> X X
  h2 -> X X
  h3 -> X X
  *** Results: 100% dropped (0/6 received)
  ```

0. Answer the following questions:

  - **Q1: Why did *pingall* fail?**
    - A1:

0. Examine ovs-ofctl

  * `mininet>` `sh ovs-ofctl help`
  
  > Add a few questions here to make the students read the help

0. Examine ovs-dpctl

  * `mininet>` `sh ovs-dpctl help`
  
  > Add a few questions here to make the students read the help

0. Collect ovs information about ports 

  `mininet>` `sh ovs-ofctl show s1`

  ```
  OFPT_FEATURES_REPLY (xid=0x2): dpid:0000000000000001
  n_tables:254, n_buffers:256
  capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
  actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
   1(s1-eth1): addr:06:52:7b:e3:8d:21
       config:     0
       state:      0
       current:    10GB-FD COPPER
       speed: 10000 Mbps now, 0 Mbps max
   2(s1-eth2): addr:02:e2:13:2d:8d:4a
       config:     0
       state:      0
       current:    10GB-FD COPPER
       speed: 10000 Mbps now, 0 Mbps max
   3(s1-eth3): addr:f2:8f:3a:2e:14:00
       config:     0
       state:      0
       current:    10GB-FD COPPER
       speed: 10000 Mbps now, 0 Mbps max
   LOCAL(s1): addr:a6:a3:5f:2d:a9:42
       config:     PORT_DOWN
       state:      LINK_DOWN
       speed: 0 Mbps now, 0 Mbps max
  OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
  ```

0.

  `mininet>` `sh ovs-ofctl dump-flows s1`
  
  ```
  NXST_FLOW reply (xid=0x4):
  ```

0.

  `mininet>` `s1 ovs-dpctl show`

  ```
  system@ovs-system:
          lookups: hit:974045 missed:6106 lost:0
          flows: 0
          masks: hit:1003498 total:4 hit/pkt:1.02
          port 0: ovs-system (internal)
          port 1: s1-eth2
          port 2: s1-eth1
          port 3: s1-eth3
          port 4: s1 (internal)
  ```

0. Add flows for L2 switch forwarding
 
  `mininet>` `sh ovs-ofctl add-flow s1 action=normal`

0.

  `mininet>` `sh ovs-ofctl dump-flows s1`
  
  ```
  NXST_FLOW reply (xid=0x4):
  cookie=0x0, duration=6.298s, table=0, n_packets=0, n_bytes=0, idle_age=6, actions=NORMAL
  ```

0. Test pingall again 
  
  `mininet>` `pingall`

0. Undo the flows we just created 
  
  * `mininet>` `sh ovs-ofctl del-flows s1`
  * `mininet>` `sh ovs-ofctl dump-flows s1`
  * `mininet>` `pingall`

0. Add some more specific flow entries:

  * `mininet>` `sh ovs-ofctl add-flow s1 cookie=5,in_port=1,actions=output:3`
  * `mininet>` `sh ovs-ofctl add-flow s1 cookie=5,in_port=3,actions=output:1`
  * `mininet>` `sh ovs-ofctl dump-flows s1`
  * `mininet>` `pingall`

0. Add a drop rule with priority

  * `mininet>` `sh ovs-ofctl add-flow s1 priority=200,actions=drop`
  * `mininet>` `sh ovs-ofctl dump-flows s1`
  * `mininet>` `pingall`
 
  > Did the drop prevent the traffic? Why or why not?

0. Replace the flows with priorities 

  * `mininet>` `sh ovs-ofctl del-flows s1 cookie=5/-1` [read docs about cookie=value/mask](http://openvswitch.org/support/dist-docs/ovs-ofctl.8.txt)
  * `mininet>` `sh ovs-ofctl add-flow s1 cookie=5,priority=199,in_port=1,actions=output:3`
  * `mininet>` `sh ovs-ofctl add-flow s1 cookie=5,priority=199,in_port=3,actions=output:1`
  * `mininet>` `sh ovs-ofctl dump-flows s1`
  * `mininet>` `pingall`

0. Remove the dropall flow

  * `mininet>` `sh ovs-ofctl del-flows s1 cookie=6/-1`
  * `mininet>` `sh ovs-ofctl dump-flows s1`
  * `mininet>` `pingall`

0. Add a flow based on mac addresses

  * `mininet>` `sh ovs-ofctl add-flow s1 cookie=7,priority=199,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,actions=output:2`
  * `mininet>` `sh ovs-ofctl add-flow s1 cookie=7,priority=199,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,actions=output:1 `
  * `mininet>` `pingall`
 
  > What's missing?

0. Add a final flow to the switch

  * `mininet>` `sh ovs-ofctl add-flow s1 dl_type=0x0806,nw_proto=1,actions=flood`
  * `mininet>` `sh ovs-ofctl dump-flows s1`
  * `mininet>` `pingall`

  > - What is dl_tyle=0x0806? 
  >
  > - What is nw_proto=1
  >
  > - Useful Links: [Link1](http://openvswitch.org/support/dist-docs/ovs-ofctl.8.txt) [Link2](https://en.wikipedia.org/wiki/EtherType) [Link3](https://en.wikipedia.org/wiki/Address_Resolution_Protocol)
  >
  > Given nw_proto=1 was allowed how did the reply (nw_proto=2) get back to the requester?

0. Cleanup  
  
  * `mininet>` `exit`
  * `student@beachhead:~$` `sudo mn --clean`
