---
date: "2016-11-26"
draft: false
weight: 300
title: "Lab 14 - Introducing the Controllers (Ryu)"
---
[Click here to find out more about Alta3 Research's SDN Training](https://alta3.com/courses/sdn)

### WEDNESDAY - &#x2B50;REQUIRED&#x2B50;

### Lab Objective
The objective of this lab is to teach how to build an SDN controller using the Ryu library. Ryu can do more than just OpenFlow, but Ryu is an OpenFlow controller library. With it, we can make Ryu library calls that allow us to build an SDN OpenFlow controller. It may be worth reminding students that an SDN contoller is one that can recieve information about packets, and send flow mods / packets in response.

### Procedure

0. Okay, let's create a new file called, *base.py*. This file will teach Ryu how to build the *skeleton framework* of a controller. It will not be able to make any modifications to the network fabric, or any packet responses. The hope is that by evaluating this skeleton, we can see what ryu-manager provides us, "out of the box", without any code written / applied.

0. Ryu-manager runs ryu-applciations. Ryu-applications 

0. Copy and paste the following ryu-application (code) into a file called *base.py*

  ``` python
  # The line b
  from ryu.base import app_manager
  from ryu.controller import ofp_event
  from ryu.controller.handler import CONFIG_DISPATCHER, MAIN_DISPATCHER
  from ryu.controller.handler import set_ev_cls
  from ryu.ofproto import ofproto_v1_3

  # create a class for our app manager
  class L2Switch(app_manager.RyuApp):

  # Define the OpenFlow version this ryu app will use
  OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]

  # initialization incantation of this class (pass in args to self)
  def __init__(self, *args, **kwargs):
     super(L2Switch, self).__init__(*args, **kwargs)

  # Handle switch feature interrogation event
  @set_ev_cls(ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER)
  def switch_features_handler(self, ev):
     return

  # Handle switch packet in event
  @set_ev_cls(ofp_event.EventOFPPacketIn, MAIN_DISPATCHER)
  def packet_in_handler(self, ev):
     return

  ```
  
0.  This is the bare minimum ryu-manager controller.  It actaully does nothing.

0. Startup wireshark and capture the packets which flow to/from the controller in this setup.

  Terminal1: `sudo wireshark &`
  
  Terminal2: `ryu-manager base.py`

  Terminal3: `sudo mn --controller=remote,ip=127.0.0.1,port=6653`

0. Answer the below questions about the wireshark capture:

  * What openflow packets were sent / received from the controller?
  * As a result of seeing these of packets, what does the ryu manager automatically do for us without any code?
  * If we ran `pingall` inside mininet would we see a PacketIn message to the controller?
  * Why or why not?

0. Tear down

  * `mininet> exit`
  * quit wireshark
  * Ctrl+C from ryu-manager
